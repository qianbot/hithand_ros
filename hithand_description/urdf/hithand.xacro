<?xml version="1.0" ?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="hithand">
    <xacro:macro name="hithand" params="attached:='false' parent:='' ns:='' rpy:='0 0 0' xyz:='0 0 0' ">

        <xacro:property name="mu1" value="0.6"/>
        <xacro:property name="mu2" value="0.6"/>

        <!-- Either attach the Hithand to the then here defined world link or attach to given robot link which itself defines the world frame -->
        <xacro:if value="${not attached}">
        <link name="world"/>
            <joint name="fixed" type="fixed">
                <parent link="world"/>
                <child link="base_link_hithand"/> 
                <origin xyz="0 0 0.1" rpy="0 0 0"/>
            </joint>
        </xacro:if>

        <xacro:if value="${attached}">
            <joint name="${ns}_hithand_joint" type="fixed">
                <parent link="${parent}"/>
                <child link="base_link_hithand"/>
                <origin xyz="${xyz}" rpy="${rpy}"/>
            </joint>
        </xacro:if>


        <!-- ++++ Define all the links and joints ++++ -->
        <!-- Starting from the base -->
        <link name="base_link_hithand">
  	        <inertial>
      		    <origin xyz="0.0112 0.0 0.0566" rpy="0 0 0" />
      		    <mass value="1.1485"/>
      		    <inertia ixx="2.2458e-3" ixy="-2.7421e-4" ixz="1.6e-5" iyy="2.2203e-3" iyz="-6.37e-5" izz="1.9003e-3" />
                <!-- <inertia ixx="2.2458e-4" ixy="0" ixz="0" iyy="2.2203e-4" iyz="0" izz="1.9003e-4" /> -->
    	    </inertial>
   	        <visual>
      		    <origin rpy="0 0 0" xyz="0 0 0" />
      		    <geometry>
        		    <mesh filename="package://hithand_description/meshes/visual/palm/hit-hand-2-palm-right.dae"/>
      		    </geometry>
      		    <material name="grey" />
    	    </visual>
    	    <collision>
      		    <!-- <origin rpy="0 0 0" xyz="0 0 0.05" />
      		    <geometry name="hithand_right_palm_collision">
        		    <box size="0.06 0.1 0.07" />
      		    </geometry> -->
                <origin rpy="0 0 0" xyz="0 0 0" />
      		    <geometry>
        		    <mesh filename="package://hithand_description/meshes/collision/palm/hit-hand-2-palm-right-merged.dae"/>
      		    </geometry>
    	    </collision>
        </link>

        <!-- Add a virtual palm link to get the transform of this point via TF for grasping (we align this frame with
        a normal of an object point cloud.) -->
        <joint name="hithand_palm_joint" type="fixed">
            <parent link="base_link_hithand"/>
            <child link="palm_link_hithand"/>
            <origin xyz="0.02 0 0.06" rpy="-0.15 -1.3 0"/>
        </joint>
        <link name="palm_link_hithand"/>



        <!-- #########################FINGER######################## -->
        <!-- Define the fingers in a macro (all fingers are equal) -->
        <!-- Joint limits set according to this: https://github.com/Qianboy/hithand_ros/blob/master/hithand_description/parameter.pdf 
        Note: Following a discussion with Qian Feng, joint limits will be set from 0.0872665 rad to 0.0 rad-->
        <xacro:macro name="finger" params="prefix *transform_palm2finger">
            <!-- +++++ Finger base joint 0 ++++++ -->
            <joint name="Right_${prefix}_0" type="revolute">
                <!-- joint origin in parent link frame -->
                <xacro:insert_block name="transform_palm2finger" />
                <parent link="base_link_hithand" />
                <child link="Right_${prefix}_Basecover" />
                <axis xyz="0 0 1" />
                <limit effort="15" lower="-0.261799" upper="0.261799" velocity="3.14"/>
                <dynamics damping="0.5" friction="0" />
            </joint>

            <link name="Right_${prefix}_Basecover">
                <inertial>
                    <origin xyz="0.02749 0 0" rpy="0 0 0" />
                    <!-- <mass value="0.0176" /> -->
                    <mass value="0.0176"/>
                    <inertia ixx="1.3450e-6" ixy="0.0" ixz="-1.8183e-7" iyy="1.9874e-6" iyz="0.0" izz="1.0419e-6" />
                    <!-- <inertia ixx="1.3450e-6" ixy="0.0" ixz="0" iyy="1.9874e-6" iyz="0.0" izz="1.0419e-6" /> -->
                </inertial>
                <visual>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                    <geometry>
                        <mesh filename="package://hithand_description/meshes/visual/finger/hit-hand-2-finger-basecover.dae"/>
                    </geometry>
                    <material name="white"/>
                </visual>
                <collision>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                    <geometry name='hithand_${prefix}_base_cover'>
                        <cylinder length="0.001" radius="0.001" />
                    </geometry>
                </collision>
            </link>


            <!-- +++++ Finger joint 1, Link: Phalanx proximalis ++++++ -->
            <joint name="Right_${prefix}_1" type="revolute">
                <origin xyz="0 0 0 " rpy="1.5708 0 0" />
                <parent link="Right_${prefix}_Basecover" />
                <child link="Right_${prefix}_Phaprox" />
                <axis xyz="0 0 1" />
                <limit effort="1.15" lower="0.0" upper="1.48353" velocity="3.14"/> <!-- Effort limit based on max fingertip force of 10N. Finger tip is approx 11.5cm away from this joint.-->
                <dynamics damping="0.5" friction="0" />
            </joint>

            <link name="Right_${prefix}_Phaprox">
                <inertial>
                    <origin xyz="0.03076 0.00297 0" 
                            rpy="0 0 0" />
                    <mass value="0.0232" />
                    <inertia ixx="2.5326e-6" ixy="-9.2551e-7" ixz="-4.0954e-8" iyy="6.9625e-6" iyz="-9.38e-9" izz="7.9108e-6" />
                    <!-- <inertia ixx="2.5326e-6" ixy="0" ixz="0" iyy="2.9625e-6" iyz="0" izz="2.9108e-6" /> -->
                </inertial>
                <visual>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                        <geometry>
                                <mesh filename="package://hithand_description/meshes/visual/finger/hit-hand-2-finger-phaprox.dae" />
                        </geometry>
                    <material name="lightblue"/>
                </visual>
                <collision>
                    <!-- <origin xyz="0.03 0 0"
                            rpy="0 0 0" />
                    <geometry name='hithand_${prefix}_phaprox'>
                        <box size="0.03 0.03 0.02" />
                    </geometry> -->
                    <origin xyz="0 0 0" rpy="0 0 0" />
                        <geometry>
                                <mesh filename="package://hithand_description/meshes/collision/finger/hit-hand-2-finger-phaprox.dae" />
                        </geometry>
                </collision>
            </link>


            <!-- +++++ Finger joint 2 Phalanx medialis ++++++ -->
            <joint name="Right_${prefix}_2" type="revolute">
                <origin xyz="0.055 0 0" rpy="0 0 0" />
                <parent link="Right_${prefix}_Phaprox" />
                <child link="Right_${prefix}_Phamed" />
                <axis xyz="0 0 1" />
                <limit effort="0.6" lower="0.0" upper="1.13446" velocity="3.14"/> <!-- Effort limit based on max fingertip force of 10N. Finger tip is approx 6cm away from this joint.-->
                <dynamics damping="0.5" friction="0" />
            </joint>

            <link name="Right_${prefix}_Phamed">
                <inertial>
                    <origin xyz="0.0097 -0.00036 0" rpy="0 0 0" />
                    <mass value="0.0158" />
                    <inertia ixx="1.1852e-6" ixy="-2.8845e-8" ixz="-6.1323e-9" iyy="2.4460e-6" iyz="2.4541e-9" izz="2.6537e-6" />
                    <!-- <inertia ixx="1.1852e-6" ixy="0" ixz="0" iyy="2.4460e-6" iyz="0" izz="2.6537e-6" /> -->
                </inertial>
                <visual>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                    <geometry>
                        <mesh filename="package://hithand_description/meshes/visual/finger/hit-hand-2-finger-phamed.dae" />
                    </geometry>
                    <material name="white"/>
                </visual>
                <collision>
                    <!-- <origin xyz="0.01 0 0" rpy="0 0 0" />
                    <geometry name='hithand_${prefix}_phamed'>
                        <box size="0.01 0.02 0.02" />
                    </geometry> -->
                    <origin xyz="0 0 0" rpy="0 0 0" />
                        <geometry>
                                <mesh filename="package://hithand_description/meshes/collision/finger/hit-hand-2-finger-phamed.dae" />
                        </geometry>
                </collision>
            </link>


            <!-- +++++ Finger joint 3 Phalanx distalis ++++++ -->
            <joint name="Right_${prefix}_3" type="revolute">
                <origin xyz="0.025 0 0" rpy="0 0 -1.570796" />
                <parent link="Right_${prefix}_Phamed" />
                <child link="Right_${prefix}_Phadist" />
                <axis xyz="0 0 1" />
                <limit effort="0.35" lower="0.0" upper="1.13446" velocity="3.14"/> <!-- Effort limit based on max fingertip force of 10N. Finger tip is approx 3.5cm away from this joint.-->
                <dynamics damping="0.5" friction="0" />
            </joint>
            <link name="Right_${prefix}_Phadist">
                <inertial>
                    <origin xyz="0.00072 0.00717 0.0" rpy="0 0 0" />
                    <mass value="0.0137" />
                    <inertia ixx="1.5519e-6" ixy="-2.037e-9" ixz="0.0" iyy="8.2972e-7" iyz="3.77e-9" izz="1.5788e-6" />
                    <!-- <inertia ixx="1.5519e-6" ixy="0" ixz="0" iyy="1.2972e-6" iyz="0" izz="1.5788e-6" /> -->
                </inertial>
                <visual>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                    <geometry>
                        <mesh filename="package://hithand_description/meshes/visual/finger/hit-hand-2-finger-phadist.dae" />
                    </geometry>
                    <material name="lightblue"/>
                </visual>
                <collision>
                    <!-- <origin xyz="0 0.01 0" rpy="0 0 0" />
                    <geometry name='hithand_${prefix}_phadist'>
                        <box size="0.02 0.035 0.02" />
                    </geometry> -->
                    <origin xyz="0 0 0" rpy="0 0 0" />
                        <geometry>
                                <mesh filename="package://hithand_description/meshes/collision/finger/hit-hand-2-finger-phadist.dae" />
                        </geometry>
                </collision>
            </link>

        </xacro:macro>
        <!-- #########################FINGER######################## -->
        <!-- END of finger macro -->

        <xacro:finger prefix="Thumb"  >
            <origin xyz="0.06217593 0.044372912 0.078734808"
                    rpy="0.225810 -1.083656 0.411355" />
        </xacro:finger>
        <xacro:finger prefix="Index"  >
            <origin xyz="-0.002529881 0.03680013 0.107783545"
                    rpy="3.054326 -1.570796 0.000000" />
        </xacro:finger>
        <xacro:finger prefix="Middle"  >
            <origin xyz="-0.0037 0.01  0.117783545"
                    rpy="-3.141593 -1.570796 0.000000" />
        </xacro:finger>
        <xacro:finger prefix="Ring"   >
            <origin xyz="0 -0.01680013 0.11258354"
                    rpy="-3.054326 -1.570796 0.000000" />
        </xacro:finger>
        <xacro:finger prefix="Little"  >
            <origin xyz="0.000971571 -0.0433963 0.093583545"
                    rpy="-2.967060 -1.570796 0.000000" />
        </xacro:finger>


    </xacro:macro>
    <!-- END of hithand macro -->

    <!-- Include the transmission and Gazebo files -->
    <xacro:include filename="$(find hithand_description)/urdf/hithand.transmission.xacro" />
    <xacro:include filename="$(find hithand_description)/urdf/hithand.gazebo" />

</robot>
